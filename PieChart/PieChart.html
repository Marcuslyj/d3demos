<!DOCTYPE html><html>
 <head>  <meta charset="utf-8">  <title>Arc Transition</title>  <link rel="stylesheet" type="text/css" href="css/styles.css" />  <script type="text/javascript" src="js/d3.min.js"></script> </head>
 <body>
  <script type="text/javascript">   var windowWidth = window.innerWidth;   var width = windowWidth,    height = windowWidth * .5,    endAngle = 2 * Math.PI,    colors = d3.scale.category20();   var temp_data;   var data = [{    startAngle: 0,    endAngle: 0.1 * endAngle,    base: 10   }, {    startAngle: 0.1 * endAngle,    endAngle: 0.2 * endAngle   }, {    startAngle: 0.2 * endAngle,    endAngle: 0.4 * endAngle   }, {    startAngle: 0.4 * endAngle,    endAngle: 0.6 * endAngle   }, {    startAngle: 0.6 * endAngle,    endAngle: 0.7 * endAngle   }, {    startAngle: 0.7 * endAngle,    endAngle: 0.9 * endAngle   }, {    startAngle: 0.9 * endAngle,    endAngle: endAngle   }];   //为什么不序列化，数组会变   var origin_data = JSON.stringify(data);
   var svg = d3.select("body").append("svg")    .attr("class", "pie")    .attr("height", height)    .attr("width", width);
   function render(innerRadius) {    var arc = d3.svg.arc().outerRadius(width * .25).innerRadius(innerRadius);    svg.select("g").remove();    svg.append("g")     .attr("transform", "translate(" + width * .5 + "," + width * .25 + ")")     .selectAll("path.arc")     .data(data)     .enter()     .append("path")     .attr("class", "arc")     .attr("fill", function(d, i) {      return colors(i);     })     .transition().duration(1000)     .attrTween("d", function(d) {      var start = {       startAngle: 0,       endAngle: 0      }; // <-A      var interpolate = d3.interpolate(start, d); // <-B      return function(t) {       return arc(interpolate(t)); // <-C      };     });
//d3.select(svg.selectAll("path.arc")[0][0]).attr("startAngel",Math.PI/18);    //点击事件    svg.selectAll("path.arc")     //点击事件     .on("click", function(d, i) {      d3.select(this).classed("hide", true);      var shows = d3.selectAll("path.arc:not(.hide)");      var paths = d3.selectAll("path.arc");      var showsLen = shows[0].length;
      if (temp_data == null) {       temp_data = data.slice();      }//      var old_data = temp_data.slice();      var old_data = JSON.stringify(temp_data);      var new_data = temp_data.slice();
      if (showsLen == 0) {       new_data = JSON.parse(origin_data);       paths.classed("hide",false);      } else {       var delta = new_data[i].endAngle - new_data[i].startAngle;       //标志       new_data[i].endAngle = new_data[i].startAngle;       var leftTotalAngel = 0;       shows.each(function(d, i) {        leftTotalAngel += d.endAngle - d.startAngle;       });
       for (var i = 0; i < paths[0].length; i++) {        if (new_data[i].startAngle == 0) {         new_data[i].endAngle = Number(new_data[i].endAngle) + delta * (new_data[i].endAngle - new_data[i].startAngle) / leftTotalAngel;        } else {         var old_delta = new_data[i].endAngle - new_data[i].startAngle;         var add_delta = delta * (new_data[i].endAngle - new_data[i].startAngle) / leftTotalAngel;         new_data[i].startAngle = new_data[i - 1].endAngle;         new_data[i].endAngle = Number(new_data[i].startAngle) + old_delta + add_delta;        }       }      }
      var arc = d3.svg.arc().outerRadius(width * .25).innerRadius(width * .1);      var paths = svg.selectAll("path.arc");      paths       .data(new_data)       .enter();      paths.each(function(d, i) {       d3.select(this)        .transition().duration(500)        .attrTween("d", function() {//         var start = old_data[i]; // <-A//???         var start = JSON.parse(old_data)[i];         var interpolate = d3.interpolate(start, d); // <-B         return function(t) {                    return arc(interpolate(t)); // <-C         };        })      });      temp_data = new_data.slice();     });             }
   render(width * .1);           </script>
 </body>
</html>
